<!DOCTYPE html>
<html  >
<head>
  <!-- Site made with Mobirise Website Builder v4.11.6, https://mobirise.com -->
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Mobirise v4.11.6, mobirise.com">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
  <link rel="shortcut icon" href="assets/images/mbr-122x122.png" type="image/x-icon">
  <meta name="description" content="">
  
  <title>Patient Dashboard</title>
  <script src="assets/web/assets/jquery/jquery-3.4.1.slim.min.js"></script>
  <link rel="stylesheet" href="assets/web/assets/mobirise-icons-bold/mobirise-icons-bold.css">
  <link rel="stylesheet" href="assets/web/assets/mobirise-icons/mobirise-icons.css">
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap-grid.min.css">
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap-reboot.min.css">
  <link rel="stylesheet" href="assets/dropdown/css/style.css">
  <link rel="stylesheet" href="assets/tether/tether.min.css">
  <link rel="stylesheet" href="assets/animatecss/animate.min.css">
  <link rel="stylesheet" href="assets/theme/css/style.css">
  <link rel="preload" as="style" href="assets/mobirise/css/mbr-additional.css"><link rel="stylesheet" href="assets/mobirise/css/mbr-additional.css" type="text/css">
  
  
  
</head>
<body>
  <section class="menu cid-qTkzRZLJNu" once="menu" id="menu1-0">

    

    <nav class="navbar navbar-expand beta-menu navbar-dropdown align-items-center navbar-fixed-top navbar-toggleable-sm">
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <div class="hamburger">
                <span></span>
                <span></span>
                <span></span>
                <span></span>
            </div>
        </button>
        <div class="menu-logo">
            <div class="navbar-brand">
                <span class="navbar-logo">
                    <a href="#">
                         <img src="assets/images/mbr-122x122.png" alt="Mobirise" title="" style="height: 3.8rem;">
                    </a>
                </span>
                <span class="navbar-caption-wrap"><a class="navbar-caption text-white display-7" href="#">Patient Dashbaord</a></span>
            </div>
        </div>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav nav-dropdown nav-right" data-app-modern-menu="true">
                <li class="nav-item">
                    <a class="nav-link link text-white display-4" href="#" id="user"><span class="mbrib-user mbr-iconfont mbr-iconfont-btn"></span>
                        </a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link link text-white dropdown-toggle display-4"  href="#" data-toggle="dropdown-submenu" aria-expanded="true" id="appointments">
                        <span class="mbrib-alert mbr-iconfont mbr-iconfont-btn"></span> &nbsp;
                    </a>
                    <div class="dropdown-menu" id="drop" style="height:auto">
                        <!--<a class="text-white dropdown-item display-4" href="#"><span class="mbri-drag-n-drop2 mbr-iconfont mbr-iconfont-btn"></span>New Item</a>-->
                    </div>
                </li>
                <li class="nav-item">
                        <a class="nav-link link text-white display-4" href="#" id="logout"><span class="mbri-arrow-prev mbr-iconfont mbr-iconfont-btn"></span>Log Out
                            </a>
                </li>

                <li class="nav-item dropdown">
                    <a class="nav-link link text-white dropdown-toggle display-4"  href="#" data-toggle="dropdown-submenu" aria-expanded="true" id="prescriptions">
                        <span class="mbrib-alert mbr-iconfont mbr-iconfont-btn"></span> &nbsp;
                    </a>
                    <div class="dropdown-menu" id="pres" style="overflow:auto;height:600px">
                        <!--<a class="text-white dropdown-item display-4" href="#"><span class="mbri-drag-n-drop2 mbr-iconfont mbr-iconfont-btn"></span>New Item</a>-->
                    </div>
                </li>
            </ul>
            
        </div>
    </nav>
</section>

<section class="engine"><a href="#"></a></section><section class="services1 cid-rIiIsMYmXP" id="services1-6">
    <!---->
    
    <!---->
    <!--Overlay-->
    
    <!--Container-->
    <div class="container">
        <div class="row justify-content-center" id="contain">
            <!--Titles-->
            <div class="title pb-5 col-12" id="doc">
                <h3 class="align-left pb-3 mbr-fonts-style display-2">Loading Available Doctors ....</h3>
                    
            </div>
            <div class="title pb-5 col-12" id="appoint">
                <h2 class="align-left pb-3 mbr-fonts-style display-2">Book An Appointment With A Doctor</h2>
                
            </div>
        </div>
    </div>
</section>

<section once="footers" class="cid-rIiKv40GkY" id="footer6-8">

    

    

    <div class="container">
        <div class="media-container-row align-center mbr-white">
            <div class="col-12">
                <p class="mbr-text mb-0 mbr-fonts-style display-7">
                    Â© Copyright 2019 Patient DashBoard - All Rights Reserved
                </p>
            </div>
        </div>
    </div>
</section>

  
  <script src="assets/popper/popper.min.js"></script>
  <script src="assets/web/assets/jquery/jquery.min.js"></script>
  <script src="assets/bootstrap/js/bootstrap.min.js"></script>
  <script src="assets/smoothscroll/smooth-scroll.js"></script>
  <script src="assets/viewportchecker/jquery.viewportchecker.js"></script>
  <script src="assets/dropdown/js/nav-dropdown.js"></script>
  <script src="assets/dropdown/js/navbar-dropdown.js"></script>
  <script src="assets/touchswipe/jquery.touch-swipe.min.js"></script>
  <script src="assets/tether/tether.min.js"></script>
  <script src="assets/theme/js/script.js"></script>
  
  
  <input name="animation" type="hidden">
  <script>
      $(document).ready(function(){
        var localToken = window.localStorage.getItem('access_token');
        var userName = window.localStorage.getItem('name');
        var user_id = window.localStorage.getItem('id');

        $("#logout").click(function(e){
            e.preventDefault();
            window.localStorage.clear();
            window.location = "patientLogin.html"
        })
        
        if(localToken !== null && userName !== null){
          $("li a#user").append(userName)

          // getting all patients prescriptions
          $.ajax({
              url: "https://virtual-healthcare.herokuapp.com/api/patient/prescriptions",
              method: 'get',
              headers: {
                  "Authorization" : `Bearer ${localToken}`
              },
              success: function(res){
                  console.log(res)
                  if(res.data.length > 0){
                    $("li a#prescriptions").append("Prescriptions "+ res.data.length);
                    var new_pres = '';
                        $.each(res.data,function(index,data){
                            new_pres = new_pres 
                                +'<a class="text-white dropdown-item display-4"><span class="mbri-drag-n-drop2 mbr-iconfont mbr-iconfont-btn"></span>'+data.case_history+'<br>'+data.medication+'<br></span></a><hr><br>'
                                +'<button class="btn btn-sm btn-primary" id="'+res.data.id+'">submit</button>'
                                if(data.submitted == 1){
                                    $("button.btn").attr("disabled","true")
                                }
                                else{
                                    $("button.btn").attr("disabled","false")
                                }
                        })
                        $("div#pres").append(new_pres)
                        $("button.btn").click(function(e){
                            e.preventDefault();
                            var prescription_id = e.currentTarget.id;
                            $.ajax({
                                url: `https://virtual-healthcare.herokuapp.com/api/patient/prescriptions/${prescription_id}/submit`,
                                method: "get",
                                success: function(res){
                                    if(res){
                                        console.log(res)
                                    }
                                },
                                error: function(err){
                                    if(err){
                                        console.log(err)
                                        if(err.statusText == "error"){
                                            $("div#doc h3").text("Netwok Error, Check and Try again").css("color","red")
                                            $("div#appoint").css("display","none")
                                        }
                                    }
                                }
                            })
                        })
                    }
                  else{
                    $("li a#prescriptions").append("No Prescriptions");
                  }
              },
              error: function(err){
                  console.log(err)
              }
          }) 

          // getting all patient appointments with the doctor 
          $.ajax({
              url: "https://virtual-healthcare.herokuapp.com/api/patient/appointments",
              method: "get",
              headers: {
                  "Authorization" : `Bearer ${localToken}`
              },
              success: function(res){
                if(res.data.length > 0){
                    $("li a#appointments").append("Appointments "+ res.data.length);
                    var new_App = '';
                        $.each(res.data,function(index,data){
                            new_App = new_App 
                                +'<a class="text-white dropdown-item display-4"><span class="mbri-drag-n-drop2 mbr-iconfont mbr-iconfont-btn"></span>'+data.doctor+'<br>'+data.appointment_date+'<br>'+data.doctor_phone+'<span style="float:right;padding-left: 8%;color:red" class="cancel" id="'+data.id+'">X</span></a><hr>'
                        })
                        $("div#drop").append(new_App)
                        $("span.cancel").click(function(e){
                            var appoint_id = e.currentTarget.id;
                            e.preventDefault();
                            $.ajax({
                                url: `https://virtual-healthcare.herokuapp.com/api/patient/cancel-appointment/${appoint_id}`,
                                method: 'delete',
                                headers: {
                                    "Authorization" : `Bearer ${localToken}`
                                },
                                success: function(res){
                                    if(res.res == "cancel"){
                                        var span = "span#"+appoint_id;
                                        $(span).parent("a").remove();
                                        location.reload()
                                    }
                                },
                                error: function(err){
                                    if(err.statusText == "error"){
                                        $("div#doc h3").text("Netwok Error, Check and Try again").css("color","red")
                                        $("div#appoint").css("display","none")
                                    }
                                }

                            })
                        })
                    }
                else{
                    $("li a#appointments").append("No Appointments")
                }
              },
              error: function(err){
                console.log(err)
              }
          });

          // getting available doctors in the hospital
          $.ajax({
              url: "https://virtual-healthcare.herokuapp.com/api/doctors",
              method: "get",
              success: function(res){
                  var new_div = '';
                  $.each(res.data,function(index,vals){
                        new_div = new_div
            +'<div class="card col-12 col-md-6 p-3 col-lg-4">'
                +'<div class="card-wrapper">'
                    +'<div class="card-img">'
                        +'<img src="" alt="Doctor">'
                    +'</div>'
                    +'<div class="card-box">'
                        +'<h4 class="card-title mbr-fonts-style display-5">'+vals.name+'</h4>'
                        +'<p class="mbr-text mbr-fonts-style display-7">'+vals.email+'</p>'
                        +'<hr>'       
                        +'<label for="">'
                            +'<p class="mbr-text mbr-fonts-style display-7">Enter Date And Time</p>'
                        +'</label><br>'
                        +'<input class="btn-sm btn btn-info-outline date" type="date" name="" value=""><br>'
                        +'<input class="btn-sm btn btn-info-outline time" type="time" name="" value="">'
                        +'<p class="err" id="'+index+'"></p>'
                        +'<div class="mbr-section-btn align-left go" id="'+vals.id+'"><a href="#" class="btn btn-secondary-outline display-4">Book Appointment</a></div>'
                    +'</div>'
                +'</div>'
            +'</div>';
        })


                  $("div#contain").append(new_div);
                  $("#doc").css("display","none");

                  $(".go").click(function(e){
                    e.preventDefault();
                    var current_target_id = e.currentTarget.id;
                    var div_id = "div#"+current_target_id;
                    var index = $(div_id).prev("p.err").attr("id");

                    var date = $("input.date")[index];
                    var time = $("input.time")[index];
                    
                    var new_date = date.value;
                    var new_time = time.value;

                        
                    if(!(new_date && new_time)){
                        $(div_id).prev("p.err").text("All feilds are required").addClass("btn-danger btn-sm")
                    }
                    else{
                        
                        $(div_id).prev("p.err").text("Loading...").addClass("btn-success btn-sm");
                       
                    
                        $.ajax({
                            url: "https://virtual-healthcare.herokuapp.com/api/patient/book-appointment",
                            method: "post",
                            dataType: "json",
                            headers: {
                                "Authorization" : `Bearer ${localToken}`
                            },
                            data: {
                                doctor_id: current_target_id,
                                appointment_date:  new_date + ' ' + new_time
                            },
                            success: function(res){
                                if(res.res == "booked"){
                                    $(div_id).prev("p.err").text(res.message).addClass("btn-success btn-sm").fadeToggle(2000)
                                }
                                if(res.res == "created"){
                                    $(div_id).prev("p.err").text(res.message).addClass("btn-success btn-sm").fadeToggle(2000);
                                    location.reload();
                                }
                            },
                            error: function(err){
                                if(err.statusText == "error"){
                                    $("div#doc h3").text("Netwok Error, Check and Try again").css("color","red")
                                    $("div#appoint").css("display","none")
                                    }
                                }
                            })
                        }
                    })
                },
              error: function(err){
                  if(err.statusText == "error"){
                      $("div#doc h3").text("Netwok Error, Check and Try again").css("color","red")
                      $("div#appoint").css("display","none")
                    }
                }
            })
        }
        else{
            window.location = "patientLogin.html"
        }
    })
  </script>
  </body>
</html>